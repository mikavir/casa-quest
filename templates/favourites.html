{% extends "base.html" %}
{% block header %}
<!-- Title -->
<title>{% block title %}Favourites{% endblock %}</title>
{% endblock %}
<!-- Main content -->
{% block content %}
<div class="container page-container">
    <!-- Heading -->
    <div class="row">
        <div class="col s12 m8 offset-m2">
            <div class="card-panel teal darken-4">

                <h4 class="center-align orange-text text-lighten-5">
                    {{ username }}'s Favourite Properties
                </h4>
                <p class="center-align orange-text text-lighten-5"> Saved Properties Awaiting Exploration!</p>
            </div>

        </div>
    </div>
    <!-- Only shown when there is no favourite properties -->
    <div class="row p-5 mx-auto" id="no-card-display">
        <div class="col s12 m8 offset-m2 card-panel orange lighten-5">
            <div class="row my-5 p-5">
                <div class="col s12 green-text text-darken-4 center">
                    <h3>Your Dream Home Awaits! ‚≠ê</h3>
                </div>
            </div>
            <div class="row my-5 p-5">
                <div class="col s12">
                    <p>Don't let your dream home slip away! Start saving your favorite properties now
                        to keep track of your top choices and make your house-hunting journey unforgettable! üè°‚ú®</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Favourite properties filtered by is favourite -->
    <div class="row">
        {% for house in houses %}
        {% if house.is_favourite == "yes" %}
        <div class="col s12 card-panel custom-card fave-card">
            <!-- System admin can see who created -->
            {% if username == "systemadmin" %}
            <div class="row">
                <div class="col s12">
                    <h6>Created By: {{house.username}}</h6>
                </div>
            </div>
            {% endif %}
            <div class="row">
                <div class="col s12 m5">
                    <!-- House image -->
                    <div class="row">
                        <div class="col s12 house-image-container">
                            <img src="{{ house.image_url }}" class="responsive-img" alt="{{house.address}}">
                        </div>
                    </div>
                    <!-- House agency -->
                    <div class="row">
                        <div class="col s12 center">
                            <h6>{{ house.agency }}</h6>
                        </div>

                    </div>
                </div>
                <!-- House address -->
                <div class="col s12 m6 m-3">
                    <div class="row mb-0">
                        <div class="col s12">
                            <h4>{{ house.address }}</h4>

                        </div>
                    </div>
                    <!-- House price -->
                    <div class="row">
                        <div class="col s12">
                            <h6><span>¬£</span> {{ house.price }}</h6>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col s12">
                            <h6>{{ house.bedrooms }} Bedroom {{ house.propertyType }} House</h6>
                        </div>
                    </div>
                    <!-- House bedroooms -->
                    <div class="row teal-text text-darken-4 mx-auto center">
                        <div class="col s3">
                            <h6>{{ house.bedrooms }}</h6>
                            <span><i class="fa-solid fa-bed fa-lg prefix"></i></span>

                        </div>
                        <!-- bathrooms -->
                        <div class="col s3">
                            <h6>{{ house.bathrooms }}</h6>
                            <span><i class="fa-solid fa-toilet fa-lg prefix"></i></span>

                        </div>
                    </div>
                    <!-- Chain free status -->
                    <div class="row m-2">
                        <div class="col s12">
                            {% if house.chainFree == "yes"%}
                            <p>Chain Free</p>
                            {% else %}
                            <p> Chain </p>
                            {% endif %}
                        </div>
                    </div>
                    <!-- Buttons -->

                    <div class="row center">
                        <div class="col s5">
                            <!-- View more -->
                            <a href="{{ url_for('view_house', house_id=house._id) }}"
                                class="btn teal darken-2 white-text rounded waves-effect waves-light profile-button">View
                                More</a>
                        </div>
                        <div class="col s5">
                            <!-- Edit button -->
                            <a href="{{ url_for('edit_new_house', house_id=house._id) }}"
                                class="btn teal darken-2 white-text icon-right rounded waves-effect waves-light profile-button">
                                <i class="material-icons">edit</i>Update
                            </a>

                        </div>
                        <div class="col s2 ml-2">
                            <!-- Remove from favourites -->
                            <form
                                action="{{ url_for('remove_from_favourites', username=username, house_id=house._id) }}"
                                method="POST">
                                <button
                                    class="btn teal darken-2 white-text rounded waves-effect waves-light profile-button"
                                    aria-label="Remove from favourites"><i class="fa-solid fa-heart"></i></button>

                            </form>
                        </div>
                    </div>
                </div>
                <!-- Delete modal button -->
                <div class="col s12 m1 right-align">
                    <a class="waves-effect waves-light btn modal-trigger red darken-4 rounded"
                        href="#deleteModal{{house._id}}"><span class="material-symbols-outlined">
                            cancel
                        </span></a>
                </div>
            </div>
        </div>
        <!-- Delete modal  -->
        <div id="deleteModal{{ house._id }}" class="modal card-panel rounded white-text center p-5">
            <!-- Modal content -->
            <div class="modal-content rounded">
                <div class="row">
                    <div class="col s12 red-text text-darken-4">
                        <i class="fa-solid fa-triangle-exclamation fa-lg"></i>
                        <h4>Caution</h4>
                    </div>
                </div>
                <div class="row">
                    <div class="col s12 black-text">
                        <p> Deleting this house will erase all associated data. Are you sure you want to proceed? Click
                            below to confirm or cancel to preserve data.</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="row">
                    <div class="col s12 center">
                        <!-- Delete button -->
                        <form action="{{ url_for('delete_house', username=username, house_id=house._id) }}"
                            method="POST">
                            <button class="modal-close btn waves-effect rounded red darken-4 m-2">Delete</button>
                            <!-- Cancel button -->
                            <a href="#" class="modal-close btn waves-effect rounded orange m-2">Cancel</a>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        {% endfor %}

    </div>
</div>
<!-- Scripts -->
<script>
    displayCard();

    function displayCard() {
        const noCardDisplayCard = document.getElementById("no-card-display");
        const faveProperties = document.querySelectorAll(".fave-card");

        if (faveProperties.length == 0) {
            noCardDisplayCard.style.display = "block";
        } else {
            noCardDisplayCard.style.display = "none";

        }

    }
</script>


{% endblock %}